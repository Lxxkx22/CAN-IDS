# Detectionæ¨¡å—æµ‹è¯•å¥—ä»¶

è¿™æ˜¯ä¸ºIDS4.0é¡¹ç›®çš„detectionæ¨¡å—è®¾è®¡çš„å®Œæ•´æµ‹è¯•å¥—ä»¶ï¼ŒåŒ…å«å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•ã€‚

## ğŸ“ æµ‹è¯•æ–‡ä»¶ç»“æ„

```
tests/
â”œâ”€â”€ __init__.py                    # æµ‹è¯•æ¨¡å—åˆå§‹åŒ–
â”œâ”€â”€ README.md                      # æœ¬æ–‡æ¡£
â”œâ”€â”€ run_all_tests.py              # æµ‹è¯•è¿è¡Œä¸»è„šæœ¬
â”œâ”€â”€ test_settings.py               # æµ‹è¯•é…ç½®å’Œè®¾ç½®
â”œâ”€â”€ test_config.py                 # æ¨¡æ‹Ÿé…ç½®ç®¡ç†å™¨
â”œâ”€â”€ test_utils.py                  # æµ‹è¯•å·¥å…·å‡½æ•°
â”œâ”€â”€ test_base_detector.py          # BaseDetectorå’ŒAlertç±»æµ‹è¯•
â”œâ”€â”€ test_drop_detector.py          # DropDetectoræµ‹è¯•
â”œâ”€â”€ test_tamper_detector.py        # TamperDetectoræµ‹è¯•
â”œâ”€â”€ test_replay_detector.py        # ReplayDetectoræµ‹è¯•
â”œâ”€â”€ test_general_rules_detector.py # GeneralRulesDetectoræµ‹è¯•
â”œâ”€â”€ test_state_manager.py          # StateManageræµ‹è¯•
â””â”€â”€ test_detection_integration.py  # é›†æˆæµ‹è¯•
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œ
python tests/run_all_tests.py
```

### è¿è¡Œç‰¹å®šç±»åˆ«çš„æµ‹è¯•

```bash
# åªè¿è¡ŒåŸºç¡€ç»„ä»¶æµ‹è¯•
python tests/run_all_tests.py basic

# åªè¿è¡Œæ£€æµ‹å™¨æµ‹è¯•
python tests/run_all_tests.py detectors

# åªè¿è¡Œé›†æˆæµ‹è¯•
python tests/run_all_tests.py integration
```

### è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶

```bash
# è¿è¡Œç‰¹å®šæ£€æµ‹å™¨çš„æµ‹è¯•
python -m unittest tests.test_drop_detector
python -m unittest tests.test_tamper_detector
python -m unittest tests.test_replay_detector

# è¿è¡Œç‰¹å®šæµ‹è¯•ç±»
python -m unittest tests.test_base_detector.TestAlert

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–¹æ³•
python -m unittest tests.test_drop_detector.TestDropDetector.test_normal_iat_detection
```

## ğŸ“‹ æµ‹è¯•è¦†ç›–èŒƒå›´

### åŸºç¡€ç»„ä»¶æµ‹è¯•

#### Alertç±» (`test_base_detector.py`)
- âœ… å‘Šè­¦å¯¹è±¡åˆ›å»ºå’Œå±æ€§è®¾ç½®
- âœ… å‘Šè­¦è½¬æ¢ä¸ºå­—å…¸æ ¼å¼
- âœ… å‘Šè­¦å­—ç¬¦ä¸²è¡¨ç¤º
- âœ… å‘Šè­¦ä¸¥é‡æ€§çº§åˆ«

#### BaseDetectorç±» (`test_base_detector.py`)
- âœ… æ£€æµ‹å™¨åˆå§‹åŒ–
- âœ… å‘Šè­¦åˆ›å»ºåŠŸèƒ½
- âœ… æ£€æµ‹å¯ç”¨/ç¦ç”¨çŠ¶æ€
- âœ… é…ç½®ç¼“å­˜æœºåˆ¶
- âœ… æ£€æµ‹å‰åå¤„ç†é’©å­
- âœ… æŠ½è±¡æ£€æµ‹æ–¹æ³•
- âœ… å†…å­˜å‹åŠ›æ¨¡å¼
- âœ… é…ç½®ç‰ˆæœ¬å˜æ›´å¤„ç†

#### StateManagerç±» (`test_state_manager.py`)
- âœ… çŠ¶æ€ç®¡ç†å™¨åˆå§‹åŒ–
- âœ… CAN IDçŠ¶æ€åˆ›å»ºå’Œæ›´æ–°
- âœ… IATè®¡ç®—å’Œç»Ÿè®¡
- âœ… è½½è·å“ˆå¸Œç®¡ç†
- âœ… åºåˆ—ç¼“å†²åŒºç®¡ç†
- âœ… å†…å­˜é™åˆ¶å’Œæ¸…ç†
- âœ… æ€§èƒ½æµ‹è¯•

### æ£€æµ‹å™¨æµ‹è¯•

#### DropDetector (`test_drop_detector.py`)
- âœ… ä¸¢åŒ…æ£€æµ‹å™¨åˆå§‹åŒ–
- âœ… IATå¼‚å¸¸æ£€æµ‹
- âœ… è¿ç»­ä¸¢å¤±å¸§æ£€æµ‹
- âœ… æœ€å¤§IATå› å­æ£€æµ‹
- âœ… å­¦ä¹ æ¨¡å¼å’Œæ£€æµ‹æ¨¡å¼
- âœ… ç‰¹æ®Šæƒ…å†µå¤„ç†ï¼ˆDLC=0ç­‰ï¼‰
- âœ… æ€§èƒ½æµ‹è¯•

#### TamperDetector (`test_tamper_detector.py`)
- âœ… ç¯¡æ”¹æ£€æµ‹å™¨åˆå§‹åŒ–
- âœ… DLCå¼‚å¸¸æ£€æµ‹
- âœ… è½½è·ç†µå¼‚å¸¸æ£€æµ‹
- âœ… å­—èŠ‚è¡Œä¸ºåˆ†æ
- âœ… å­—èŠ‚å˜åŒ–ç‡æ£€æµ‹
- âœ… åŸºçº¿æ•°æ®ä¾èµ–å¤„ç†
- âœ… æ€§èƒ½æµ‹è¯•

#### ReplayDetector (`test_replay_detector.py`)
- âœ… é‡æ”¾æ£€æµ‹å™¨åˆå§‹åŒ–
- âœ… å¿«é€Ÿé‡æ”¾æ£€æµ‹
- âœ… å¢å¼ºå¿«é€Ÿé‡æ”¾æ£€æµ‹
- âœ… ä¸Šä¸‹æ–‡è½½è·é‡å¤æ£€æµ‹
- âœ… åºåˆ—é‡æ”¾æ£€æµ‹
- âœ… å‘¨æœŸæ€§æ¨¡å¼è¯†åˆ«
- âœ… æ€§èƒ½æµ‹è¯•

#### GeneralRulesDetector (`test_general_rules_detector.py`)
- âœ… é€šç”¨è§„åˆ™æ£€æµ‹å™¨åˆå§‹åŒ–
- âœ… æœªçŸ¥IDæ£€æµ‹
- âœ… Shadowå­¦ä¹ æ¨¡å¼
- âœ… è‡ªåŠ¨æ·»åŠ IDåŠŸèƒ½
- âœ… åŸºçº¿å¼•æ“é›†æˆ
- âœ… æ€§èƒ½æµ‹è¯•

### é›†æˆæµ‹è¯• (`test_detection_integration.py`)

- âœ… æ­£å¸¸æµé‡å¤„ç†
- âœ… å¤šç§æ”»å‡»æ£€æµ‹
- âœ… æ£€æµ‹å™¨ååŒå·¥ä½œ
- âœ… çŠ¶æ€ä¸€è‡´æ€§
- âœ… å‘Šè­¦ä¸¥é‡æ€§åˆ†å¸ƒ
- âœ… é”™è¯¯å¤„ç†
- âœ… å†…å­˜ä½¿ç”¨ç¨³å®šæ€§
- âœ… æ€§èƒ½æ¯”è¾ƒ

## ğŸ”§ æµ‹è¯•é…ç½®

æµ‹è¯•é…ç½®ä½äº `test_settings.py` æ–‡ä»¶ä¸­ï¼ŒåŒ…å«ï¼š

- **æ£€æµ‹å™¨é…ç½®**: å„ä¸ªæ£€æµ‹å™¨çš„å‚æ•°è®¾ç½®
- **æ€§èƒ½æµ‹è¯•é…ç½®**: æ€§èƒ½æµ‹è¯•çš„é˜ˆå€¼å’Œé™åˆ¶
- **æ”»å‡»æ¨¡æ‹Ÿé…ç½®**: æ¨¡æ‹Ÿæ”»å‡»çš„å‚æ•°
- **æµ‹è¯•æ•°æ®é…ç½®**: æµ‹è¯•ç”¨çš„CAN IDå’Œè½½è·æ¨¡å¼
- **åŸºçº¿æ•°æ®é…ç½®**: æ¨¡æ‹Ÿçš„åŸºçº¿å¼•æ“æ•°æ®

## ğŸ¯ æµ‹è¯•å·¥å…·

### æµ‹è¯•å·¥å…·å‡½æ•° (`test_utils.py`)

- `create_test_frame()`: åˆ›å»ºæµ‹è¯•ç”¨CANå¸§
- `create_frame_sequence()`: åˆ›å»ºCANå¸§åºåˆ—
- `create_drop_attack_frames()`: ç”Ÿæˆä¸¢åŒ…æ”»å‡»åºåˆ—
- `create_tamper_attack_frames()`: ç”Ÿæˆç¯¡æ”¹æ”»å‡»åºåˆ—
- `create_replay_attack_frames()`: ç”Ÿæˆé‡æ”¾æ”»å‡»åºåˆ—
- `create_unknown_id_frames()`: ç”ŸæˆæœªçŸ¥IDåºåˆ—

### æ¨¡æ‹Ÿç»„ä»¶ (`test_config.py`)

- `MockConfigManager`: æ¨¡æ‹Ÿé…ç½®ç®¡ç†å™¨
- `create_mock_baseline_engine()`: åˆ›å»ºæ¨¡æ‹ŸåŸºçº¿å¼•æ“

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

è¿è¡Œæµ‹è¯•åä¼šç”Ÿæˆè¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Šï¼ŒåŒ…æ‹¬ï¼š

- âœ… æˆåŠŸçš„æµ‹è¯•æ•°é‡å’Œç™¾åˆ†æ¯”
- âŒ å¤±è´¥çš„æµ‹è¯•è¯¦æƒ…
- âš ï¸ è·³è¿‡çš„æµ‹è¯•åŸå› 
- â±ï¸ æµ‹è¯•æ‰§è¡Œæ—¶é—´
- ğŸ¨ å½©è‰²è¾“å‡ºä¾¿äºæŸ¥çœ‹ç»“æœ

## ğŸ” è°ƒè¯•æµ‹è¯•

### å¢åŠ è¯¦ç»†è¾“å‡º

```bash
# ä½¿ç”¨-vå‚æ•°å¢åŠ è¯¦ç»†è¾“å‡º
python -m unittest -v tests.test_drop_detector
```

### è¿è¡Œç‰¹å®šæµ‹è¯•è¿›è¡Œè°ƒè¯•

```bash
# åªè¿è¡Œå¤±è´¥çš„æµ‹è¯•
python -m unittest tests.test_drop_detector.TestDropDetector.test_abnormal_iat_detection
```

### ä½¿ç”¨Pythonè°ƒè¯•å™¨

```python
# åœ¨æµ‹è¯•ä»£ç ä¸­æ·»åŠ æ–­ç‚¹
import pdb; pdb.set_trace()
```

## ğŸ“ˆ æ€§èƒ½æµ‹è¯•

æ€§èƒ½æµ‹è¯•åŒ…å«åœ¨å„ä¸ªæµ‹è¯•æ–‡ä»¶ä¸­ï¼Œä¸»è¦æµ‹è¯•ï¼š

- **å¤„ç†é€Ÿåº¦**: æ¯ç§’å¤„ç†çš„å¸§æ•°
- **å†…å­˜ä½¿ç”¨**: å†…å­˜å¢é•¿å’Œæ¸…ç†
- **å“åº”æ—¶é—´**: æ£€æµ‹å»¶è¿Ÿ
- **æ‰©å±•æ€§**: å¤§æ•°æ®é›†å¤„ç†èƒ½åŠ›

### æ€§èƒ½åŸºå‡†

- æœ€å°å¤„ç†é€Ÿåº¦: 1000å¸§/ç§’
- æœ€å¤§å†…å­˜å¢é•¿: 1MB
- æœ€å¤§å¤„ç†å»¶è¿Ÿ: 1ms/å¸§

## ğŸš¨ å¸¸è§é—®é¢˜

### å¯¼å…¥é”™è¯¯

å¦‚æœé‡åˆ°æ¨¡å—å¯¼å…¥é”™è¯¯ï¼Œç¡®ä¿ï¼š

1. åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œæµ‹è¯•
2. Pythonè·¯å¾„åŒ…å«é¡¹ç›®æ ¹ç›®å½•
3. æ‰€æœ‰ä¾èµ–æ¨¡å—å·²æ­£ç¡®å®‰è£…

### æµ‹è¯•å¤±è´¥

å¦‚æœæµ‹è¯•å¤±è´¥ï¼š

1. æ£€æŸ¥é”™è¯¯ä¿¡æ¯å’Œå †æ ˆè·Ÿè¸ª
2. ç¡®è®¤æµ‹è¯•ç¯å¢ƒé…ç½®æ­£ç¡®
3. æ£€æŸ¥æ˜¯å¦æœ‰ä»£ç å˜æ›´å½±å“äº†æµ‹è¯•
4. è¿è¡Œå•ä¸ªæµ‹è¯•è¿›è¡Œè°ƒè¯•

### æ€§èƒ½æµ‹è¯•å¤±è´¥

å¦‚æœæ€§èƒ½æµ‹è¯•å¤±è´¥ï¼š

1. æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
2. è°ƒæ•´æ€§èƒ½é˜ˆå€¼ï¼ˆåœ¨test_settings.pyä¸­ï¼‰
3. ç¡®è®¤æµ‹è¯•ç¯å¢ƒçš„ç¡¬ä»¶é…ç½®

## ğŸ”„ æŒç»­é›†æˆ

è¿™ä¸ªæµ‹è¯•å¥—ä»¶è®¾è®¡ä¸ºå¯ä»¥è½»æ¾é›†æˆåˆ°CI/CDæµæ°´çº¿ä¸­ï¼š

```bash
# CIè„šæœ¬ç¤ºä¾‹
#!/bin/bash
set -e

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python tests/run_all_tests.py

# æ£€æŸ¥æµ‹è¯•è¦†ç›–ç‡ï¼ˆå¦‚æœå®‰è£…äº†coverageï¼‰
# coverage run -m unittest discover tests
# coverage report
```

## ğŸ“ è´¡çŒ®æŒ‡å—

æ·»åŠ æ–°æµ‹è¯•æ—¶è¯·éµå¾ªä»¥ä¸‹è§„èŒƒï¼š

1. **å‘½åè§„èŒƒ**: æµ‹è¯•æ–‡ä»¶ä»¥`test_`å¼€å¤´ï¼Œæµ‹è¯•æ–¹æ³•ä»¥`test_`å¼€å¤´
2. **æ–‡æ¡£å­—ç¬¦ä¸²**: æ¯ä¸ªæµ‹è¯•æ–¹æ³•éƒ½åº”æœ‰æ¸…æ™°çš„æ–‡æ¡£å­—ç¬¦ä¸²
3. **æ–­è¨€æ¶ˆæ¯**: ä½¿ç”¨æœ‰æ„ä¹‰çš„æ–­è¨€æ¶ˆæ¯
4. **æµ‹è¯•éš”ç¦»**: ç¡®ä¿æµ‹è¯•ä¹‹é—´ç›¸äº’ç‹¬ç«‹
5. **æ¸…ç†èµ„æº**: åœ¨tearDownä¸­æ¸…ç†æµ‹è¯•èµ„æº

### æµ‹è¯•æ¨¡æ¿

```python
def test_new_feature(self):
    """æµ‹è¯•æ–°åŠŸèƒ½çš„æè¿°"""
    # Arrange - å‡†å¤‡æµ‹è¯•æ•°æ®
    test_data = create_test_data()
    
    # Act - æ‰§è¡Œè¢«æµ‹è¯•çš„æ“ä½œ
    result = function_under_test(test_data)
    
    # Assert - éªŒè¯ç»“æœ
    self.assertEqual(result, expected_value, "è¯¦ç»†çš„é”™è¯¯æ¶ˆæ¯")
```

## ğŸ“ æ”¯æŒ

å¦‚æœåœ¨ä½¿ç”¨æµ‹è¯•å¥—ä»¶æ—¶é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æœ¬READMEæ–‡æ¡£
2. æ£€æŸ¥æµ‹è¯•é…ç½®æ–‡ä»¶
3. æŸ¥çœ‹å…·ä½“çš„æµ‹è¯•ä»£ç å®ç°
4. æäº¤issueæè¿°é—®é¢˜

---

**æ³¨æ„**: è¿™ä¸ªæµ‹è¯•å¥—ä»¶æ˜¯ä¸ºIDS4.0é¡¹ç›®çš„detectionæ¨¡å—ä¸“é—¨è®¾è®¡çš„ï¼Œç¡®ä¿åœ¨æ­£ç¡®çš„é¡¹ç›®ç¯å¢ƒä¸­è¿è¡Œã€‚